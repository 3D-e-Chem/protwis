{% for type, selected_items in selection.items %}
    {% if type == selection_type %}
    <p>
        <span class="selection-heading-text">Selected {{ selection_type }}</span>
        {% if selected_items|length > 0 %}
        <a onclick="ClearSelection('{{ selection_type }}')" class="btn btn-danger btn-xs">
            <span class="glyphicon glyphicon-remove"></span> Clear
        </a>
        {% endif %}
    </p>
        {% if selection_type == 'segments' %}
            {% for group in selection.site_residue_groups %}
                Interaction {{ forloop.counter }}
                {% for selected_item in selected_items %}
                    {% if selected_item.properties.site_residue_group == forloop.parentloop.counter %}
                <div class="target-selection">
                        {{ selected_item.item.label|safe }}
                    
                    <select class="form-control" id="sel-res-{{ forloop.counter }}" 
                        onchange="SelectResidueFeature('{{ selection_type }}', '{{ selected_item.type }}',
                        {{ selected_item.item.id }}, this.value)">
                        <option value='any'>Select feature..</option>
                        {% for slug, name in amino_acid_group_names.items %}
                        <option
                        {% if selected_item.properties.feature == slug %} selected {% endif %}value='{{ slug }}'>
                        {{ name }}</option>
                        {% endfor %}
                    </select>
                    <a 
                    onclick="RemoveFromSelection('{{ selection_type }}', '{{ selected_item.type }}',
                    {{ selected_item.item.id }})" class="btn btn-danger btn-xs">
                        <span class="glyphicon glyphicon-remove"></span>
                    </a>
                    {% if selected_item.properties.amino_acids %}
                    ({{ selected_item.properties.amino_acids }})
                    {% endif %}
                </div>
                    {% endif %}
                {% endfor %}
            {% empty %}
            None
            {% endfor %}
        {% else %}
            {% for selected_item in selected_items %}
            <div class="target-selection">
                {{ selected_item.item.name|safe }}
                {% if selected_item.item.species.common_name %}
                    [{{ selected_item.item.species.common_name|safe }}]
                {% endif %}

                ({{ selected_item.type_title }})
                <a 
                onclick="RemoveFromSelection('{{ selection_type }}', '{{ selected_item.type }}',
                {{ selected_item.item.id }})" class="btn btn-danger btn-xs">
                    <span class="glyphicon glyphicon-remove"></span>
                </a>
            </div>
            {% empty %}
            None
            {% endfor %}
        {% endif %}
    {% endif %}
{% endfor %}